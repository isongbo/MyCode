实训项目：数据采集系统(DMS)
一、软件项目开发流程
1.需求分析：业务语言->技术语言、归纳和整理、
《需求规格说明书》
2.概要设计：技术路线、结构框架、开发计划
《概要设计说明书》
3.详细设计：功能性详细描述、类型、函数、各种条件、流程设
   计、关键算法、关键库接口
《详细设计说明书》
4.编写代码：编写程序代码、基本测试、单元测试和集成测试
5.测试：功能、性能、压力、健壮性、稳定性，等等
《测试报告》
6.发布：打包、文档、工程实施、售后服务、技术支持
7.项目总结
二、数据采集系统
1.背景
2.客户机
1)需求分析
A.角色：系统管理员、日志读取器、日志发送器
B.事件流：
备份系统日志，产生一个备份文件，备份文件用系统时间作为后缀，如：wtmpx.20140822100329。
读取上次匹配剩余的登入记录(有登入没登出的记录)。
读取备份文件，产生用户登入登出记录：用户名、IP地址、登录类型、时间、进程标识、IP地址长度。
把登入登出记录进行匹配，形成登录记录：用户名、IP地址、登入时间、登出时间、在线时间。
对于有登入没登出的记录，保存到登入文件中，以后匹配。对于有登出没登入的记录，丢弃。
连接服务器，发送匹配记录，如果失败，把没发出去的记录保存在失败文件中，下次重发。
C.前置条件
日志文件所在的目录和文件名：/var/adm/wtmpx
保存登入记录的文件：./logins.dat
发送失败文件：./fail.dat
服务器IP地址和端口号：192.168.0.26:8888
D.后置条件
登录匹配记录
E.绘制用例图
2)概要设计
客户机/服务器架构
数据存储在Oracle数据库中，通过Pro*C访问数据库
网络通信基于Socket实现TCP通信，服务要求支持并发
绘制结构框图
3)详细设计
A.类图
逻辑对象：LogRec、MLogRec
异常对象：exception
                  |
                 +- ClientException
                       |
                      + ReadException
                      + SaveException
                      + BackupException
                      + SocketException
                      + SendException 
日志读取器：LogReader
日志发送器：LogSender
                      |
                     + SocketSender
                     + ConsoleSender
采集客户机类：Client
B.时序图：按照时间顺序表现对象之间的互操作，一方面验证类
设计的完整性和合理性，另一方面为过程代码的编写提供依据。
C.活动图：着意刻画每个函数内部的执行过程。类似于传统意义
的流程图。
D.状态图：着意刻画每个函数内部的执行过程。强调对象状态的
变化。
4)编写代码
3.服务器
1)需求分析
A.角色
系统管理员：启动数据采集服务器
数据采集服务器：创建服务器套接字和存储线程
服务器套接字：等待客户机的连接请求，创建客户线程
客户线程：接收客户机上传的匹配日志记录，存入日志队列
日志队列：缓存来自客户机的匹配日志记录
存储线程：监视日志队列，将队列中的匹配日志记录存入数据库
数据访问对象：数据存储的抽象接口
数据库：匹配日志记录的持久化存储
B.事件流
*** 接收数据 ***
a)建立服务器侦听socket
b)等待并接受来自客户机的连接请求
c)为该客户机创建一个专门的线程为其提供服务
b)接收发自特定客户机的匹配日志记录，存入缓冲区队列
*** 存储数据 ***
a)连接数据库
b)通过一个专门的线程，监视日志缓冲区队列
c)只要日志缓冲区队列非空，就提取日志记录通过数据访问对象
   存入数据库
d)关闭和数据库的连接
C.前置条件：IP地址和端口号，客户机的连接。
D.后置条件：数据库中的记录。
E.用例图
2)概要设计
数据采集服务器：Server
服务器套接字：ServerSocket
客户线程：ClientThread \
日志队列：LogQueue       > LogThread
存储线程：StoreThread  /
数据访问对象：LogDao->FileDao
                                      ->OracleDao
数据对象：MLogRec                             / SocketException
异常对象：exception -> ServerException - DBException
                                                               \ ThreadException
3)详细设计
A.类图：定义每个类的内部和外部接口。
B.时序图：跑通整个流程，验证类图对事件流的符合性。
C.活动图/状态图：细化每个函数的实现细节。
------------------------------------------------------------------
补充内容：线程的C++封装